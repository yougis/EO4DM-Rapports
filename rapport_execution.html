<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hugo Roussaffa">
<meta name="keywords" content="Sécheresse végétale, Pacifique Sud, Observation de la Terre">

<title>Suivi de la sécheresse dans les territoires insulaire du Pacifique</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="rapport_execution_files/libs/clipboard/clipboard.min.js"></script>
<script src="rapport_execution_files/libs/quarto-html/quarto.js"></script>
<script src="rapport_execution_files/libs/quarto-html/popper.min.js"></script>
<script src="rapport_execution_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="rapport_execution_files/libs/quarto-html/anchor.min.js"></script>
<link href="rapport_execution_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rapport_execution_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="rapport_execution_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="rapport_execution_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="rapport_execution_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Autres formats</h2><ul><li><a href="rapport_execution.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Suivi de la sécheresse dans les territoires insulaire du Pacifique</h1>
<p class="subtitle lead">Rapport d’exécution technique</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Auteur·rice</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Hugo Roussaffa </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            OEIL - Observatoire de l’Environnement en Nouvelle-Calédonie
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Date de publication</div>
    <div class="quarto-title-meta-contents">
      <p class="date">12-03-2024</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Résumé</div>
    Ce rapport présente les résultats et les livrables obtenus dans le cadre du projet de suivi de la sécheresse dans les territoires insulaires du Pacifique. Il comprend une description des objectifs, de la méthodologie, des résultats, des livrables. Le rapport est accompagné d’annexes comprenant des informations complémentaires, des graphiques et des tableaux.
  </div>
</div>

<div>
  <div class="keywords">
    <div class="block-title">Mots clés</div>
    <p>Sécheresse végétale, Pacifique Sud, Observation de la Terre</p>
  </div>
</div>

</header>


<div>

</div>
<div class="centering quarto-layout-panel" data-latex="" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<p><img src="ressources/logos/OEIL.png" style="height:20.0%" alt="Logo oeil"> <img src="ressources/logos/logo_fond_pacifique.png" class="img-fluid" style="width:33.0%" alt="Logo FP"> <img src="ressources/logos/AFD.png" class="img-fluid" style="width:33.0%" alt="Logo AFD"></p>
</div>
</div>
</div>
<section id="contexte-général-du-projet" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Contexte général du projet</h1>
<p>Les évènements extrêmes de plus en plus présents dans le Pacifique (phénomènes El Nino &amp; La Nina) ont des conséquences non négligeables sur les territoires insulaires. L’effet de la montée des eaux ou des épisodes de sécheresse est donc au centre des préoccupation dans de nombreuses îles du Pacifique (Vanuatu, Wallis-et-Futuna, Polynésie Française, etc.). Les évènements de sécheresse intenses ont des impacts indéniables sur la biodiversité, la ressource en eau et sur les cultures agricoles comme cela a pu être le cas en 2019 pour la Nouvelle-Calédonie.</p>
<p>Actuellement, le suivi et l’anticipation de ces épisodes de sécheresse se fait via des mesures météorologiques informant sur le déficit pluvieux et non pas sur le stress hydrique des plantes. Par ailleurs, les données sont uniquement disponibles sur quelques points de mesure et ne sont pas continues sur les territoires.</p>
</section>
<section id="description-du-projet-suivi-de-la-sécheresse-dans-les-territoires-insulaire-du-pacifique" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Description du projet “Suivi de la sécheresse dans les territoires insulaire du Pacifique”</h1>
<p>Le projet proposé ici s’inscrit dans la continuité du travail mené dans le cadred du projet Space Climate Observatory, nommé EO4DroughtMonitoring<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> sur la Nouvelle-Calédonie avec comme objectif principal de démontrer l’applicabilité et l’utilité d’un tel outil dans d’autres territoires insulaires du Pacifique. La démarche globale est ainsi de disposer d’un procédé adapté pour l’ensemble des territoires insulaires du Pacifique et qui pourrait par la suite être délivré en libre accès de façon opérationnelle en lien avec les acteurs centraux de la région.</p>
<p>Le projet présenté ici vise&nbsp;:</p>
<ul>
<li>à construire un indicateur de sécheresse végétale permettant de caractériser la situation actuelle mais aussi historique et prévisionnel, en fonction des données disponibles, obtenues sur les différents plateformes satellitaires et des instruments météorologiques du territoires concernés,</li>
<li>mettre en production l’indicateur sur la Nouvelle-Calédonie, l’objectif étant de démontrer le caractère opérationnel de la solution,</li>
<li>décliner la chaine de production pour les territoires de la région Pacifique,</li>
<li>le valoriser à travers des interfaces et des services de consultation et de mise à disposition des données.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/presentation_generale.png" class="img-fluid figure-img"></p>
<figcaption>presentation générale du système</figcaption>
</figure>
</div>
<p>Cette solution fournie des données constituant une source d’informations importante dont les valorisations et apports peuvent être multiples : agriculture, gestion des ressources, sécurité (surveillance du risque incendie), état de l’environnement. Les produits satellites utilisés dans cet outil couvrent l’intégralité des territoires. L’ensemble des livrables est mis à disposition de la communauté sous licence open source type BSD<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<section id="parties-prenantes" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="parties-prenantes"><span class="header-section-number">2.1</span> Parties prenantes</h2>
<p>Le projet implique plusieurs partenaires techniques et scientifiques, notamment l’OEIL, INSIGHT, l’IRD Nouvelle-Calédonie, Météo-France Nouvelle-Calédonie, CSIRO, CPS, la Direction de l’agriculture de la Polynésie Française, Fidji et le Gouvernement du Vanuatu.</p>
<p>Le travail est mené par 3 entités principales :</p>
<p><strong>L’Observatoire de l’Environnement pour la Nouvelle-Calédonie (OEIL)</strong> réalise le suivi de l’environnement sur le territoire en fournissant, via leurs plateformes opérationnelles, plusieurs indicateurs et outils de surveillance environnementale. Porteur du projet, l’OEIL a le rôle de cadrage global du projet, de valorisation et de portage final de l’indicateur sécheresse développé pour la NC. Grâce à son expertise dans le domaine, il s’assurera également du bon déroulement du travail mené par les différents partenaires sur les aspects techniques, thématiques via un soutien scientifique du <strong>Conseil Scientifique de l’OEIL</strong>.</p>
<p><strong>INSIGHT</strong> est une startup néo-calédonienne du Groupe CIPAC (Compagnie Industrielle du Pacifique) dédiée à l’observation de la Terre par imagerie spatiale. INSIGHT a été en charge des développements de l’indicateur de sécheresse biophysique sur la Nouvelle-Calédonie, en collaboration avec Météo-France NC au moment du projet SCO. Dans la présente étude, INSIGHT est en charge de la mise en production des différentes chaines d’indicateur sur la Nouvelle-Calédonie, d’études techniques et scientifiques, et des développements supplémentaires pour l’accès et le traitement d’images satellites sur tous les territoires identifiés.</p>
<p><strong>L’IRD Nouvelle-Calédonie (UMR EspaceDEV)</strong> apporte un soutien scientifique et technique à ce projet. De par son expertise en Observation de la Terre dédiée à l’étude de l’environnement Néo-Calédonien, cet organisme de recherche suivra de près les développements réalisés pour aider au bon déroulement du projet.</p>
<p>D’autres acteurs ont été identifiés pour être sollicités au cours de l’étude afin de disposer d’un soutien technique et thématique : <strong>METEO-FRANCE NOUVELLE-CALEDONIE</strong>, en tant que le dévelopeur actuel de la chaine des prévisions. Une convention avec Météo-France sur l’utilisation de la chaine en production et sur d’autres territoires à été signée (disponible en annexe <span class="math inline">\(\ref{sec-conv-MNF-OEIL}\)</span>)</p>
<p><strong>CSIRO</strong> : expertise attendue dans l’exploitation des données Radar et du DataCube Australien</p>
<p><strong>CPS</strong> : expertise attendue sur l’exploitation du DataCube Digital Earth Pacifique</p>
<p><strong>Direction de l’agriculture de la Polynésie Française</strong> : collaboration attendue pour la mise à disposition de données météo in situ</p>
<p><strong>Gouvernement ou Université du Vanuatu</strong> : collaboration attendue pour la mise à disposition de données météo in situ</p>
<p><strong>AGENCE RURALE Nouvelle Calédonie</strong> : utilisateur probable des données d’indicateurs produites.</p>
</section>
<section id="méthodologie" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="méthodologie"><span class="header-section-number">2.2</span> Méthodologie</h2>
<p>La chaine de production sur la Nouvelle-Calédonie est présentée en <a href="#fig-schema-general" class="quarto-xref">Figure&nbsp;1</a>. La production de l’indicateur actuel est réalisée via trois sous chaines permettant d’accéder aux trois niveaux d’information sécheresse (communal, intra-communal, parcellaire).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/EO4DM_Echelles.jpg" class="img-fluid figure-img"></p>
<figcaption>3 échelles d’information sécheresse</figcaption>
</figure>
</div>
<p>L’ensemble des chaines forme un système de suivi et de prévision de la sécheresse dans les territoires du Pacifique. Chaque chaine est composée de plusieurs étapes de traitement, de calcul et de contrôle qualité. Les données d’entrée sont issues de différentes sources (satellites, données météo in situ, etc.) et sont traitées pour produire des indicateurs de sécheresse végétale (VAI, VHI, MAI, prévision).</p>
<div id="fig-schema-general" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-schema-general-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/SCHEMA_GENERAL_EO4DM.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schema-general-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Le système de suivi et la prévision de la sécheresse dans les territoires du Pacifique
</figcaption>
</figure>
</div>
<p>###&nbsp;VAI : La chaine locale</p>
<p>La chaine locale fournie l’indicateur au niveau parcellaire (10 m), calculé à partir des indices NDWI issus de L8 et S2 préalablement prétraités et calibrés. L’indicateur VAI (Vegetation Anomaly Index ; Amri et al., 2011 ; Peters et al., 2002) sera estimé par comparaison au référentiel selon l’équation</p>
<p><span class="math display">\[
VAI = NDWI - \frac{\overline{NDWI}} {\sigma NDWI}
\]</span></p>
<p>avec <span class="math inline">\(\overline{NDWI}\)</span> la moyenne et <span class="math inline">\(\sigma{NDWI}\)</span> l’écart-type calculés pour une décade (10 jours), sur tout l’historique. Cet indicateur est centré en 0, avec des valeurs négatives indiquant un état de stress anormal, et des valeurs positives indiquant un état favorable. A noter que pour cette échelle spécifique, une phase de post-traitement peut être intégrée afin de filtrer les régions de sols nus ou à végétation dense pouvant être d’un intérêt moindre pour un suivi parcellaire. Cette étape peut être réalisée à partir d’indices de NDVI calculés à partir des mêmes images L7/L8/L9/S2, mais impliquant également, une calibration radiométrique.</p>
<p>###&nbsp;VHI : La chaine globale</p>
<p>La chaine globale fournie l’indicateur au niveau intra-communal (1 km) à partir des indices MODIS (NDWI, LST). Ici, l’indicateur VHI (Vegetation Health Index ; Kogan, 1997, 2000) est estimé selon l’équation suivante : <span class="math display">\[
VHI = \alpha * VCI + (1-\alpha) * TCI
\]</span></p>
<p>avec <span class="math inline">\(\alpha = 0.5\)</span>, et où le VCI et le TCI sont définis selon Kogan (1995, 1997) et obtenus respectivement à partir du NDWI et de la LST. Cet indicateur est centré en 0,5. Un VHI de 0 correspondra à l’état le plus défavorable (végétation sèche), alors qu’une valeur de 1 correspondra à l’état le plus favorable (végétation en bonne santé).</p>
<section id="mai-la-chaine-dalerte" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="mai-la-chaine-dalerte"><span class="header-section-number">2.2.1</span> MAI : La chaine d’alerte</h3>
<p>La chaine d’alerte fournie un indicateur communal issu de la combinaison d’indicateurs satellites et météorologiques. L’objectif ici est de déterminer à quel stade se situe le déficit dans la relation de cause à effet de la sécheresse agricole (Sepulcre-Canto, 2012) : un déficit pluviométrique entrainant un déficit d’humidité du sol, ayant lui-même pour effet le stress hydrique de la végétation. Pour cela, nous intégrons les indicateurs fournis par Météo-France sur leurs stations (SPI, SPEI), l’indicateur VHI ainsi que l’indicateur d’anomalies d’humidités du sol MAI (Moisture Anomaly Index ; Amri et al., 2012 ; Le Page et Zribi, 2019), provenant des données micro-ondes ASCAT.</p>
<p>Trois niveaux d’alerte sécheresse seront alors fournis par commune : - <strong>Watch</strong> : Niveau d’alerte minimale correspondant à une détection de déficit pluviométrique, mais sans impact observé sur la surface végétalisé.</p>
<ul>
<li><p><strong>Warning</strong> : Niveau intermédiaire avec détection de déficit observé au niveau de la surface (humidité du sol, évapotranspiration), mais sans stress hydrique directement observé sur la végétation.</p></li>
<li><p><strong>Alert</strong> : Niveau d’alerte maximale avec détection d’un état de stress hydrique de la végétation.</p></li>
</ul>
</section>
<section id="indicateur-prévisionnel" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="indicateur-prévisionnel"><span class="header-section-number">2.2.2</span> Indicateur prévisionnel</h3>
<p>L’indicateur prévisionnel est issu des développements réalisés par Météo-France NC. Le produit se présente sous la forme de cartes à l’échelle communale informant sur les tendances d’évolution de la sécheresse végétale à +1 mois, +2 mois et +3 mois (à partir du mois en cours). Cet indicateur est obtenu à partir de la connaissance de deux types d’informations : - La forte corrélation observée entre les produits de sécheresse météorologique (en particulier le SPI-3 mois issus des stations) et l’indicateur global de sécheresse végétale (produit satellite VHI). Le SPI-3 mois est alors qualifié de « proxy » météorologique de la sécheresse végétale. - Les prévisions de précipitation informant sur les probabilités d’évolution de SPI (Lavaysse, 2020). Ces produits correspondent aux prévisions d’ensemble accessibles via le Global Drought Observatory, et qui ont été évaluées et calibrées localement via les données SPI issues des stations (réadaptation des scores et classes d’évolution au territoire).</p>
<p>Ces indicateurs peuvent ensuite être utilisés pour étudier, surveiller, analyser et prévoir les périodes de sécheresse dans les territoires monitorés.</p>
<p>L’algorithmie de chaque chaine est détaillée précisement dans la <span class="citation" data-cites="algo-chaines">@algo-chaines</span>. <img src="ressources/ALGO_CHAINES_EO4DM.png" id="fig-algo-chaines" class="img-fluid" alt="Déscription du fonctionnement détaillée des chaines"></p>
<p>La méthodologie pour les développements et validations scientifiques des indicateurs et des chaines de traitement est détaillée dans les rapports de production du projet SCO. Nous invitons le lecteur à se référer à ces rapports pour tout complément d’information à ce sujet.</p>
</section>
<section id="actualisation-et-livraison-des-produits" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="actualisation-et-livraison-des-produits"><span class="header-section-number">2.2.3</span> Actualisation et livraison des produits</h3>
<p>Afin de limiter l’impact des nuages sur les produits satellites tout en gardant une répétitivité adaptée à l’évolution de la sécheresse, le pas de temps sélectionné pour l’actualisation de l’indicateur de sécheresse locale (VAI) est de 10 jours, et de 8 jours pour l’indicateur de sécheresse globale (VHI).</p>
<p>Du fait de la mise à disposition des données météorologiques à un pas de temps mensuel, les cartes d’alertes et cartes de prévisions seront fournies au mois (milieu du mois suivant).</p>
<p>Les données météorologiques, incluant les produits observés (SPI, SPEI) et le les produits prévisionnels (tendances d’évolution), sont déposées par Météo-France NC sur un serveur dédié. L’accès à ce serveur se fait à travers un accès ftp fournis dans le cadre de la convention <span class="math inline">\(\ref{sec-conv-MNF-OEIL}\)</span>, et se chargera de récupérer les fichiers autour du 15 du mois suivant, date à laquelle les données seront complètes et validées par Météo-France.</p>
<p>Le chronogramme ci-dessous <a href="#fig-chronogramme" class="quarto-xref">Figure&nbsp;2</a> présente l’actualisation des indicateurs sur deux mois. Ce schéma est répété de manière à couvrir la totalité de la période en mode opérationnel. Il s’agit notamment de mettre en évidence la procédure de mise à disposition des produits pour leur production et leur diffusion opérationnelle.</p>
<div id="fig-chronogramme" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-chronogramme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/chronogramme.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-chronogramme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Chronogramme de l’actualisation des produits
</figcaption>
</figure>
</div>
<ul>
<li>Livraison 1, au début du mois 2 incluant les produits infra-mensuels :
<ul>
<li>indicateurs de sécheresse locale VAI obtenus durant le mois 1</li>
<li>indicateurs de sécheresse globale VHI obtenus durant le mois 1</li>
</ul></li>
<li>Livraison 1bis, en milieu du mois 2 incluant :
<ul>
<li>les produits mensuels d’alertes du mois 1</li>
<li>les produits mensuels de prévisions du mois 1</li>
<li>une synthèse mensuelle des indicateurs VAI et VHI agrégés sur le mois 1</li>
</ul></li>
<li>La livraison 2, en début du mois 3 incluant les produits infra-mensuels VAI et VHI du mois 2</li>
</ul>
</section>
<section id="etudes-réalisées-au-cours-du-projet" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="etudes-réalisées-au-cours-du-projet"><span class="header-section-number">2.2.4</span> Etudes réalisées au cours du projet</h3>
<p>Le projet à permit d’ameliorer la chaine issu du SCO, sur certains points méthodologiques à travers la réalisation des études suivantes :</p>
<ul>
<li><p>Étude d’une solution de gapfilling pour les données Landsat 7</p></li>
<li><p>Etude pour le choix du DataCube (GEE, Sentinel Hub, Data-Terra, Digital Earth Pacific)</p></li>
<li><p>Etude pour l’intégration du capteur VIIRS en remplacement de MODIS</p></li>
<li><p>Etude pour l’intégration du produit CHIRPS pour le calcul des indices SPI et SPEI</p></li>
</ul>
<p>Ces études font partie des livrables du projet et sont disponibles en annexe Section <span class="math inline">\(\ref{Annexes}\)</span>.</p>
</section>
</section>
<section id="outils-et-technologies-utilisés" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="outils-et-technologies-utilisés"><span class="header-section-number">2.3</span> Outils et technologies utilisés</h2>
<section id="télédétection-à-partir-de-données-accessibles" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="télédétection-à-partir-de-données-accessibles"><span class="header-section-number">2.3.1</span> Télédétection à partir de données accessibles</h3>
<p>Le projet repose sur l’utilisation de données open data pour la télédétection de la sécheresse végétale. Ces données sont essentielles pour l’analyse et la surveillance des variations de la santé de la végétation, de l’humidité et la température.</p>
<ul>
<li>Sentinel 2 pour l’optique multispectrale (NDVI, NDWI)</li>
<li>Landsat 7, 8, 9 pour l’optique multispectrale</li>
<li>MODIS: Aqua, Terra pour le thermique</li>
<li>ASCAT pour les micro-ondes</li>
</ul>
</section>
<section id="utilisation-du-langage-python-pour-le-développement-des-chaines-de-traitement" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="utilisation-du-langage-python-pour-le-développement-des-chaines-de-traitement"><span class="header-section-number">2.3.2</span> Utilisation du langage Python pour le développement des chaines de traitement</h3>
<p>Le langage Python est utilisé pour le développement des chaines de traitement. Il est largement utilisé dans le domaine de la télédétection et de l’analyse de données. De plus, nous utiliseons conda pour la gestion des dépendances et des environnements virtuels de développement, de qualification et de production. Les dépendances de la version 1.0.0 sont disponible en <a href="#sec-dependencies" class="quarto-xref">Section&nbsp;4.3</a>.</p>
<p>La documentation de l’ensemble de la chaine est disponible sur le dépôt git de l’OEIL et en annexe</p>
</section>
<section id="utilisation-de-google-earth-engine" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="utilisation-de-google-earth-engine"><span class="header-section-number">2.3.3</span> Utilisation de Google Earth Engine</h3>
<p>Google Earth Engine est utilisé pour accéder aux sources de données et pour réaliser certains traitements sur les données satellitaires. Cette plateforme cloud permet d’analyser de grandes quantités de données géospatiales de manière efficace et rapide.</p>
</section>
<section id="utilisation-de-docker-pour-lorchestration-des-chaines-de-traitement" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="utilisation-de-docker-pour-lorchestration-des-chaines-de-traitement"><span class="header-section-number">2.3.4</span> Utilisation de docker pour l’orchestration des chaines de traitement</h3>
<p>Docker est utilisé pour l’orchestration des chaînes de traitement. Cette technologie de conteneurisation garantit la portabilité et la reproductibilité des environnements de développement, facilitant ainsi le déploiement et la gestion des applications.</p>
</section>
<section id="utilisation-de-azure-devops" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5" class="anchored" data-anchor-id="utilisation-de-azure-devops"><span class="header-section-number">2.3.5</span> Utilisation de Azure devops</h3>
<p>Azure DevOps est une suite d’outils utilisés dans le cadre du projet pour le déploiement des chaînes de traitement (CI), la gestion de projet, la collaboration, la gestion du code source (GIT), la documentation, le suivi des version, des bugs et des évolutions, ce qui permet une gestion très efficace du projet.</p>
<section id="gestion-de-projet" class="level4" data-number="2.3.5.1">
<h4 data-number="2.3.5.1" class="anchored" data-anchor-id="gestion-de-projet"><span class="header-section-number">2.3.5.1</span> Gestion de projet</h4>
<p>Azure DevOps offre des fonctionnalités avancées de gestion de projet, notamment la planification agile, le suivi des tâches, la création de tableaux Kanban et la gestion des sprints. Ces fonctionnalités permettent une organisation efficace des activités du projet, en assurant une visibilité et une traçabilité optimales des progrès réalisés.</p>
</section>
<section id="collaboration" class="level4" data-number="2.3.5.2">
<h4 data-number="2.3.5.2" class="anchored" data-anchor-id="collaboration"><span class="header-section-number">2.3.5.2</span> Collaboration</h4>
<p>Azure DevOps facilite la collaboration en offrant des outils de communication intégrés, tels que les commentaires sur les tâches, les discussions dans les problèmes et les pull requests.</p>
</section>
</section>
<section id="gestion-du-code-source" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6" class="anchored" data-anchor-id="gestion-du-code-source"><span class="header-section-number">2.3.6</span> Gestion du code source</h3>
<p>Azure DevOps fournit des fonctionnalités robustes de contrôle de version et de gestion du code source. Grâce à l’intégration native avec Git, les développeurs peuvent travailler efficacement sur le code, créer des branches, fusionner des modifications et suivre l’évolution du code source au fil du temps.</p>
</section>
<section id="déploiement-continu-cicd" class="level3" data-number="2.3.7">
<h3 data-number="2.3.7" class="anchored" data-anchor-id="déploiement-continu-cicd"><span class="header-section-number">2.3.7</span> Déploiement continu (CI/CD)</h3>
<p>L’intégration continue (CI) et le déploiement continu (CD) sont des pratiques essentielles pour assurer la qualité et la fiabilité du logiciel. Azure DevOps propose des pipelines CI/CD flexibles et personnalisables, permettant d’automatiser les tests, la compilation, la validation et le déploiement des applications de manière cohérente et reproductible. C’est cette “brique” qui permet de parametrer et d’orchestrer le déploiement en production.</p>
</section>
</section>
</section>
<section id="déroulement-du-projet" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Déroulement du projet</h1>
<section id="phasage-du-projet" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="phasage-du-projet"><span class="header-section-number">3.1</span> Phasage du projet</h2>
<ul>
<li><strong>Phase 0</strong> (Septembre 2022 – Mars 2023): Réunion de démarrage, monté en compétence et, études préalables.</li>
<li><strong>Phase 1</strong> (Janvier 2023 – Septembre 2023): Adaptation de la chaine développée pendant le projet SCO <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> pour la Nouvelle-Calédonie.</li>
<li><strong>Phase 2</strong> (Septembre 2023 – Janvier 2024): Adaptations et évolutions de la chaine pour la régionalisation Pacifique.</li>
<li><strong>Phases 3</strong> (Juin 2023 – Avril 2024) : Orchestration de la chaine et monitoring.</li>
<li><strong>Phases 4</strong> (Decembre 2023 – Août 2024): Restitutions, finalisation.</li>
</ul>
</section>
<section id="bilan-des-actions-réalisées" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="bilan-des-actions-réalisées"><span class="header-section-number">3.2</span> Bilan des actions réalisées</h2>
<p>Le développement et la mise en production du système sécheresse végétale est effectif. Les indicateurs VAI (locale), VHI (globale) et d’alerte MAI pour la Nouvelle-Calédonie sont produits de manière continue sur le serveur hébérgé par INSIGHT. Les indicateurs ne sont pas encore accessibles directement par une interface web de consultation et de téléchargement mais ce point est en cours de reflexion. La chaine prévisionnelle vient d’être finalisé et demande encore un effort pour son intégration dans le système. Ce point est en cours de mise en oeuvre.</p>
<p>La collaboration entre les différents partenaires techniques et scientifiques de la région pacifique ont bien eu lieu à travers des échanges et de restitutions. Nous avons adapté les chaines de traitement et produit les indicateurs pour certaines partie du territoire de Fidji, du Vanuatu et de la polynesie Française. Le système n’a toutefois pas les indicateur nécessitant des données météo in situ (alerte et prévision).</p>
<section id="exemple-de-résultats-obtenus" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="exemple-de-résultats-obtenus"><span class="header-section-number">3.2.1</span> Exemple de résultats obtenus</h3>
<div id="fig-cartes201812" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cartes201812-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cartes201812" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-carte-VAI201812" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-carte-VAI201812-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/ex_carte_VAI_20181201_20.png" class="img-fluid figure-img" data-ref-parent="fig-cartes201812">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-carte-VAI201812-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) carte VAI 2018/12
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cartes201812" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-carte-VHI201812" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-carte-VHI201812-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/ex_carte_VHI_201812.png" class="img-fluid figure-img" data-ref-parent="fig-cartes201812">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-carte-VHI201812-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) carte VHI 2018/12
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cartes201812-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Comparaison des cartes VAI et VHI pour le mois de décembre 2018
</figcaption>
</figure>
</div>
<div id="fig-cartes201904" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cartes201904-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cartes201904" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-carte-VAI201904" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-carte-VAI201904-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/ex_carte_VAI_20190401_20.png" class="img-fluid figure-img" data-ref-parent="fig-cartes201904">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-carte-VAI201904-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) carte VAI 2019/04
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cartes201904" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-carte-VHI201904" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-carte-VHI201904-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/ex_carte_VHI_201904.png" class="img-fluid figure-img" data-ref-parent="fig-cartes201904">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-carte-VHI201904-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) carte VHI 2019/04
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cartes201904-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Comparaison des cartes VAI et VHI pour le mois d’avril 2019
</figcaption>
</figure>
</div>
<div id="fig-cartes201912" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cartes201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cartes201912" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-carte-VAI201912" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-carte-VAI201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/ex_carte_VAI_20191201_20.png" class="img-fluid figure-img" data-ref-parent="fig-cartes201912">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-carte-VAI201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) carte VAI 2019/12
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cartes201912" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-carte-VHI201912" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-carte-VHI201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/ex_carte_VHI_201912.png" class="img-fluid figure-img" data-ref-parent="fig-cartes201912">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-carte-VHI201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) carte VHI 2019/12
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cartes201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Comparaison des cartes VAI et VHI pour le mois de décembre 2019
</figcaption>
</figure>
</div>
<div id="fig-cartes201912" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cartes201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/VHI_FIDJI.png" class="img-fluid figure-img"></p>
<figcaption>carte VHI FIDJI</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/VHI_PF.png" class="img-fluid figure-img"></p>
<figcaption>carte VHI Vanuatu</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/VHI_Vanuatu.png" class="img-fluid figure-img"></p>
<figcaption>carte VHI Polynesie</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cartes201912-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Cartes VHI sur les territoires de la région Pacifique
</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/evo_moyenne_VHI_mois.png" class="img-fluid figure-img"></p>
<figcaption>Evolution temporelle des moyennes de VHI par commune et par mois</figcaption>
</figure>
</div>
</section>
<section id="proposition-pour-la-valoriation-des-résultats-des-chaines" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="proposition-pour-la-valoriation-des-résultats-des-chaines"><span class="header-section-number">3.2.2</span> Proposition pour la valoriation des résultats des chaines</h3>
<section id="catalogue-stac-spatiotemporal-asset-catalog" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="catalogue-stac-spatiotemporal-asset-catalog"><span class="header-section-number">3.2.2.1</span> Catalogue STAC (SpatioTemporal Asset Catalog)</h4>
<p>Rendre l’accès aux données facilitée via la mise en place d’un catalogue STAC (SpatioTemporal Asset Catalog) pour permettre aux utilisateurs de découvrir, explorer et accéder aux données de manière efficace.</p>
<p><img src="ressources/STAC_CATALOG.png" class="img-fluid" alt="Interface de l’application webSTAC BROWSER permettant de rechercher dans le catalogue"> <img src="ressources/STAC_BROWSER.png" class="img-fluid" alt="Ecran de l’application STAC BROWSER pour une donnée spécifique"></p>
<p>Ce type de catalogue permettrait par ailleur de faciliter le partage et le moissonage par d’autre plateforme comme la plateforme Data du Gouvernement de Nouvelle Calédonie et/ou le Pacifique Data Hub mis en place par la CPS.</p>
</section>
<section id="intégration-des-données-dans-le-cube-digital-earth-pacific" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="intégration-des-données-dans-le-cube-digital-earth-pacific"><span class="header-section-number">3.2.2.2</span> Intégration des données dans le cube Digital Earth Pacific</h4>
<p>La récente mise en production du DataCube Digital Earth Pacific offre une opportunité pour intégrer les données de sécheresse végétale dans ce cube. Cette intégration permettrait de faciliter l’accès et l’exploitation des données par les utilisateurs finaux, notamment les décideurs et les gestionnaires de ressources naturelles.</p>
<p>Des échanges avec la CPS sont prévues prochainement dans ce sens afin de determiner les modalités de mise en oeuvre d’une telle intégration.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/DEP.png" class="img-fluid figure-img"></p>
<figcaption>Interface de Digital Earth Pacific</figcaption>
</figure>
</div>
<section id="développement-dune-application-web-de-consultation-de-données" class="level5" data-number="3.2.2.2.1">
<h5 data-number="3.2.2.2.1" class="anchored" data-anchor-id="développement-dune-application-web-de-consultation-de-données"><span class="header-section-number">3.2.2.2.1</span> Développement d’une application web de consultation de données</h5>
<p>Nous souhaitons mettre a disposition d’utilisateur une interface de consultation simplifié et intuitive pour accéder aux données du <strong>dispositif sécheresse végétale</strong>. Cette application web pourrait permettre de visualiser les données de sécheresse dans leurs dimensions temporelle et spatiale. Le développement d’un telle application doit d’abord faire l’objet d’un projet d’accompagnement de l’agence rural de Nouvelle-Calédonie pour définir les fonctionnalités à prévoir en cohérences à leurs besoins spécifiques et des utilisateurs finaux.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/EO4DM-WEBMAP.jpg" class="img-fluid figure-img"></p>
<figcaption>Exemple de plateforme Web de consultation des résultats</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="livrables" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="livrables"><span class="header-section-number">3.2.3</span> Livrables</h3>
<ul>
<li>Étude gapfilling Landsat 7 <a href="#sec-gapfilling" class="quarto-xref">Section&nbsp;4.4.1</a></li>
<li>Etude pour le choix du DataCube (GEE, Sentinel Hub, Data-Terra, Digital Earth Pacific) <span class="math inline">\(\ref{sec-datacube}\)</span></li>
<li>Etude pour l’intégration du capteur VIIRS en remplacement de MODIS <a href="#sec-deco-MODIS" class="quarto-xref">Section&nbsp;4.4.3</a></li>
<li>Document d’aide au controle qualité des données des chaines <a href="#sec-cq" class="quarto-xref">Section&nbsp;4.5</a></li>
<li>Présentation PGRSC (OperationalVegetationDroughtProcessing_PGRSC_Neuhauser_et_al_2023) <span class="math inline">\(\ref{sec-pgrsc}\)</span></li>
<li>Code source
<ul>
<li>chaine locale (documentation d’exploitation et documentation de code associées)</li>
<li>chaine globale (documentation d’exploitation et documentation de code associées)</li>
<li>chaine alerte (documentation d’exploitation et documentation de code associées)</li>
<li>chaine prévisionnelle - MFNC (documentation d’exploitation et documentation de code associées)</li>
<li>code source du calcul SPI et SPEI avec GEE via l’utilisation des données du programme CHIRPS (documentation de code associées)<br>
</li>
</ul></li>
<li>Données/fichiers produits en continu</li>
</ul>
<section id="nombre-de-fichiers-produit-à-ce-jour" class="level4" data-number="3.2.3.1">
<h4 data-number="3.2.3.1" class="anchored" data-anchor-id="nombre-de-fichiers-produit-à-ce-jour"><span class="header-section-number">3.2.3.1</span> Nombre de fichiers produit à ce jour</h4>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Indice/indicateur</th>
<th style="text-align: center;">Source</th>
<th style="text-align: center;">Fréquence</th>
<th style="text-align: center;">Nombre de fichiers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">NDVI/NDWI</td>
<td style="text-align: center;">Landsat 7 8 9/Sentinel 2</td>
<td style="text-align: center;">par décade</td>
<td style="text-align: center;"><strong>4816</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">LST</td>
<td style="text-align: center;">MODIS</td>
<td style="text-align: center;">par décade</td>
<td style="text-align: center;"><strong>1724</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">LST</td>
<td style="text-align: center;">MODIS</td>
<td style="text-align: center;">par mois</td>
<td style="text-align: center;"><strong>577</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">SwI</td>
<td style="text-align: center;">ASCAT</td>
<td style="text-align: center;">par jour</td>
<td style="text-align: center;"><strong>6102</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">SwI</td>
<td style="text-align: center;">ASCAT</td>
<td style="text-align: center;">par mois</td>
<td style="text-align: center;"><strong>205</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">VHI</td>
<td style="text-align: center;">chaine global</td>
<td style="text-align: center;">par decade</td>
<td style="text-align: center;"><strong>864</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">VHI</td>
<td style="text-align: center;">chaine global</td>
<td style="text-align: center;">par mois</td>
<td style="text-align: center;"><strong>290</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">VAI</td>
<td style="text-align: center;">chaine locale</td>
<td style="text-align: center;">par decade</td>
<td style="text-align: center;"><strong>4020</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">MAI</td>
<td style="text-align: center;">chaine alerte</td>
<td style="text-align: center;">par mois</td>
<td style="text-align: center;"><strong>206</strong></td>
</tr>
</tbody>
</table>
<p>Le volume de stackage nécessaire à la production de l’indicateur sur la Nouvelle-Calédonie a été estimé dans <a href="#fig-volume-stockage" class="quarto-xref">Figure&nbsp;7</a></p>
<div id="fig-volume-stockage" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-volume-stockage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ressources/tableau_volume.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-volume-stockage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Estimation des volumes de stockage nécessaire
</figcaption>
</figure>
</div>
</section>
</section>
<section id="réunions-et-échanges" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="réunions-et-échanges"><span class="header-section-number">3.2.4</span> Réunions et échanges</h3>
<ul>
<li>3 COPILS</li>
<li>2 restitutions des études réalisées</li>
<li>15 Ateliers de travail</li>
<li>1 réunion avec le conseil Scientifique de l’OEIL</li>
<li>3 visio-conférences avec les partenaires de la région pacifique</li>
</ul>
</section>
<section id="restitutions-publiques" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="restitutions-publiques"><span class="header-section-number">3.2.5</span> Restitutions publiques</h3>
<p>Une présentation de la chaine a été faite à la conference du 27 Novembre au 1 Decembre 2023 à Fiji - PGRSC: An Operational Vegetation Drought Processing Chain based on Google Earth Engine satellite imagery and meteorological products. Cette conférence a retenue l’attention de <strong>250 participants</strong>. Le contenu de la présentation est disponible en annexe <span class="math inline">\(\ref{sec-pgrsc}\)</span></p>
<!--ANNEXES -->
<!-- c'est l'include pdf de latex qui intégre le titre car sinon il y a un saut de page provenant de quarto -->
</section>
</section>
</section>
<section id="sec-Annexes" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Annexes</h1>
<p><object data="ressources/conventions/231205_Convention.pdf" type="application/pdf"><iframe src="ressources/conventions/231205_Convention.pdf">This browser does not support PDFs. Please download the PDF to view it: <a href="ressources/conventions/231205_Convention.pdf">Download PDF</a></iframe></object></p>
<section id="documentation-des-chaines-de-traitement" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="documentation-des-chaines-de-traitement"><span class="header-section-number">4.1</span> Documentation des chaines de traitement</h2>
</section>
<section id="eo4dm-pipeline" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="eo4dm-pipeline"><span class="header-section-number">4.2</span> EO4DM PIPELINE</h2>
<section id="table-des-matières" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="table-des-matières"><span class="header-section-number">4.2.1</span> Table des Matières</h3>
<ul>
<li><a href="#présentation-générale">Présentation générale</a></li>
<li><a href="#configuration-google-earth-engine-(gee)">Configuration Google Earth Engine (GEE)</a></li>
<li><a href="#utilisation-%22test%22">Utilisation “Test”</a></li>
<li><a href="#utilisation-%22service-régulier%22">Utilisation “Service-Régulier”</a></li>
<li><a href="#algorithmes">Algorithmes</a></li>
<li><a href="#cas-d'usages">Cas d’usages</a></li>
<li><a href="#intégration-continue-(ci)">Intégration Continue (CI)</a></li>
</ul>
</section>
<section id="présentation-générale" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="présentation-générale"><span class="header-section-number">4.2.2</span> Présentation générale</h3>
<p>Ce dépôt contient la pipeline de traitement permettant la production des indicateurs de sécheresse développés dans le cadre du projet EO4DM (Earth Observation For Drought Monitoring). A la racine, se trouvent les fichiers servant à l’installation, l’intégration continue ainsi que la configuration de lancement de la pipeline.</p>
<p>Le dossier “<a href="dmpipeline">dmpipeline</a>” contient les différents packages et scripts en python pour le traitement des produits intervenant dans la pipeline (images satellites, données météorologiques). On y trouve les scripts principaux des trois chaines LOCALE, GLOBALE et ALERTE : - <a href="EO4DM/dmpipeline/LocalDrought_ProcessingChain.py">LocalDrought_ProcessingChain.py</a> : sécheresse végétale à haute résolution spatiale (10 m) - <a href="EO4DM/dmpipeline/GlobalDrought_ProcessingChain.py">GlobalDrought_ProcessingChain.py</a> : sécheresse végétale à moyenne résolution spatiale (500 m) - <a href="EO4DM/dmpipeline/AlertDrought_ProcessingChain.py">AlertDrought_ProcessingChain.py</a> : alertes sécheresse à échelle régionale (synthèse par zones)</p>
<p>Quatre sous-dossiers correspondent aux modules (packages) suivants : - <a href="EO4DM/dmpipeline/ALERT_Processing">ALERT_Processing</a> : scripts de la chaine Alerte et identifiants pour l’accès aux produits Copernicus (<a href="EO4DM/dmpipeline/ALERT_Processing/ftp_accounts">ftp_accounts</a>) - <a href="EO4DM/dmpipeline/DROUGHT_Processing">DROUGHT_Processing</a> : scripts pour le calcul des indicateurs sécheresse aux échelles locales et globales - <a href="EO4DM/dmpipeline/GEE_Processing">GEE_Processing</a> : scripts pour l’accès, le prétraitement et le téléchargement des produits GEE (Google Earth Engine), ainsi que les identifiants Google (<a href="EO4DM/dmpipeline/GEE_Processing/gee_accounts">gee_accounts</a>) - <a href="EO4DM/dmpipeline/GEOSTATS_Processing">GEOSTATS_Processing</a> : scripts pour le calcul de statistiques spatiales des indicateurs</p>
<p>Le sous-dossier <a href="EO4DM/dmpipeline/tests_notebooks">tests_notebooks</a> contient des notebooks jupyter pour le test de certaines fonctionnalités des chaines. Certains tests unitaires restent à faire.</p>
<p>Le sous-dossier <a href="EO4DM/dmpipeline/ANNEX_Data">ANNEX_Data</a> contient des données annexes pouvant être nécessaires à la pipeline : - Landsat_Grid_Word : contours des différentes tuiles landsat sur l’ensemble du globe, nécessairement utilisées par la chaine LOCALE - Territory : exemple de données pouvant être utilisées par la chaine GLOBALE pour le calcul de statistiques spatiales (/Areas, /Landcover), et nécessairement utilisées par la chaine ALERTE (/Stations) . Ici, à titre d’exemple, les produits fournis sont ceux de la Nouvelle-Calédonie et devront être adaptés/modifiés pour d’autres territoires d’étude.</p>
<p>Un sous-dossier <a href="EO4DM/dmpipeline/DOC">DOC</a> contient de la documentation utile.</p>
<p>La pipeline peut s’utiliser de deux manières : - Utilisation “Test”, pour un production en un seul coup, chaine par chaine, et qui est recommandée pour une première prise en main des chaines (cf.&nbsp;section <a href="#utilisation-%22test%22">Utilisation “Test”</a>) - Utilisation “Service-Régulier, pour une production continue et parallelisée des chaines via un environnenent Docker, adaptée à la mise en place d’un service de production régulier (cf.&nbsp;section <a href="#utilisation-%22service-régulier%22">Utilisation “Service-Régulier”</a>)</p>
</section>
<section id="configuration-google-earth-engine-gee" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="configuration-google-earth-engine-gee"><span class="header-section-number">4.2.3</span> Configuration Google Earth Engine (GEE)</h3>
<p>Pour collecter et prétraiter les produits satellites MODIS, LANDSAT-7-8-9 et SENTINEL-2, les chaines LOCALES et GLOBALES se basent sur l’API python GEE (earthengine-api).</p>
<p>Afin que la pipeline appelle correctement l’API, l’utilisateur doit au préalable : 1) S’enregistrer sur GEE et créer un projet dédié à l’utilisation de la pipeline (cf.&nbsp;<a href="https://code.earthengine.google.com/register">Register</a>) 2) Créer un compte de service Google dédié qui permettra l’authentification/initialisation automatique de l’API GEE à chaque lancement de la pipeline (cf.&nbsp;<a href="https://developers.google.com/earth-engine/guides/service_account">Service Acccount</a>) 3) Générer une clé privée au format JSON contenant les identifiants du compte 4) Placer la clé privée dans le dossier <a href="EO4DM/dmpipeline/GEE_Processing/gee_accounts">gee_accounts</a> (cf.&nbsp;fichier exemple <a href="dmpipeline/GEE_Processing/gee_accounts/eo4dm_service_key.json">eo4dm_service_key.json</a>)</p>
<p>Depuis l’espace en ligne du projet GEE (Asset Manager, Code Editor) : 1) Créer un nouveau dossier ‘Annex’ (cf.&nbsp;<a href="https://developers.google.com/earth-engine/guides/asset_manager">Managing Assets</a>) 2) Importer le fichier <a href="EO4DM/dmpipeline/ANNEX_Data/Landsat_Grid_Word/Landsat_Grid_Word.zip">Landsat_Grid_Word.zip</a> dans ‘projects/id-du-projet-gee/assets’ (cf.&nbsp;<a href="https://developers.google.com/earth-engine/guides/table_upload">Importing Table Data</a>) 3) Déplacer le fichier Landsat_Grid_Word dans ‘Annex’</p>
<p>Pour la chaine LOCALE, il est possible de définir une zone selon laquelle les indices GEE seront découpés (par défault la découpe est faite selon l’emprise des tuiles Landsat). Pour cela : 1) Générer une couche vecteur au format shapefile contenant la (les) contour(s) de la zone (plusieurs polygones sont possibles) 2) Compresser dans un fichier zip nommé ‘Landmask_Grid_ROI.zip’ 3) Depuis l’espace en ligne du projet GEE, importer le fichier Landmask_Grid_ROI dans ‘projects/id-du-projet-gee/assets’, puis le déplacer dans ‘Annex’</p>
</section>
<section id="utilisation-test" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="utilisation-test"><span class="header-section-number">4.2.4</span> Utilisation “Test”</h3>
<p>Le fichier <a href="setup.py">setup.py</a> installe les différents modules de la pipeline.</p>
<p>Les librairies python nécessaires sont : - rasterio - pandas - geopandas - gdal - earthengine-api - PyDrive - python-dotenv - setuptools - scipy - tqdm</p>
<section id="fichier-de-configuration" class="level4" data-number="4.2.4.1">
<h4 data-number="4.2.4.1" class="anchored" data-anchor-id="fichier-de-configuration"><span class="header-section-number">4.2.4.1</span> Fichier de configuration</h4>
<p>Le fichier <a href="Config_process.env">Config_process.env</a> configure le lancement des chaines. Plusieurs variables d’environnement sont à définir selon l’usage souhaité. Pour une utilisation via Docker, ne pas modifier ce fichier et se référer directement à la section <a href="#utilisation-service-régulier">Utilisation “Service-Régulier</a>.</p>
<p>Les différentes variables de configuration et leur fonction sont décrites dans le fichier, dont certaines sont facultatives. On y trouve tout d’abord les chemins vers les dossiers d’écriture (WRK_DIR) et de lecture (DATA_HISTO, ANNEX_DIR) des chaines, spécifiques à l’environnement d’installation de la pipeline. Ensuite, un certain nombre de variables de fonctionnement permettent de paramétrer les traitements à réaliser. Voici les principales variables à renseigner : - TERRITORY : nom anglais du Territoire/Pays à traiter, nécessaire dans GEE pour collecter les produits satellites - MODE : Mode de fonctionnement des chaines (AUTO, MANUAL, INDICES, DROUGHT) - PERIOD_START : Date de début de la période à traiter (inclusive) - PERIOD_END : Date de fin de la période à traiter (exclusive) - TILES_L : Nom des tuiles landsat à traiter (facultatif) - TILES_S2 : Nom des tuiles sentinel-2 à traiter (facultatif)</p>
</section>
<section id="installer-via-pip" class="level4" data-number="4.2.4.2">
<h4 data-number="4.2.4.2" class="anchored" data-anchor-id="installer-via-pip"><span class="header-section-number">4.2.4.2</span> Installer via pip</h4>
<p>Le fichier <a href="libraries.txt">libraries</a> décrit les dépendances nécessaires.</p>
<p>S’assurer d’avoir installé virtualenv, se placer à la racine (dossier EO4DM), et exécuter :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv dmpipeline</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> dmpipeline/bin/activate <span class="er">(</span><span class="ex">linux</span><span class="kw">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./dmpipeline/Scripts/Activate.ps1</span> <span class="er">(</span><span class="ex">windows</span><span class="kw">)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> libraries.txt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> setup.py install</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Installer <code>rasterio</code> avec pip peut être problématique, en particulier avec Windows (cf.&nbsp;<a href="https://iotespresso.com/installing-rasterio-in-windows/">link</a>). Si c’est le cas, privilégier conda.</p>
</section>
<section id="installer-via-conda" class="level4" data-number="4.2.4.3">
<h4 data-number="4.2.4.3" class="anchored" data-anchor-id="installer-via-conda"><span class="header-section-number">4.2.4.3</span> Installer via conda</h4>
<p>Le fichier <a href="environment.yml">environment.yml</a> décrit les dépendances nécessaires.</p>
<p>Exécuter :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">--file</span> environment.yml</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate dmpipeline</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> setup.py install</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="exécution" class="level4" data-number="4.2.4.4">
<h4 data-number="4.2.4.4" class="anchored" data-anchor-id="exécution"><span class="header-section-number">4.2.4.4</span> Exécution</h4>
<p>Une fois le fichier de configuration complété, chaque chaine se lance de manière indépendante. Ici, chaque chaine sera exécutée une seule fois sur la période et la région souhaitées. Une fois l’ensemble des indicateurs calculés, la chaine s’arrête et c’est à l’utilisateur de la relancer si nécessaire.</p>
<p>Exécuter la chaine locale :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">localDM</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Exécuter la chaine globale :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globalDM</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Exécuter la chaine alerte :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alertDM</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="utilisation-service-régulier" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="utilisation-service-régulier"><span class="header-section-number">4.2.5</span> Utilisation “Service-Régulier”</h3>
<p>Il est possible de lancer et exécuter les différentes chaines via Docker. Chaque chaine aura ainsi son conteneur Docker associé, mais basée sur une image commune qui contiendra l’ensemble des librairies nécessaires au projet en utilisant un environnement Conda. Cette image est basée sur Linux, avec une installation de Python et Conda : - <a href="Dockerfile">Dockerfile</a> contient les instructions pour la construction de l’image Docker - <a href="docker-compose.yml">docker-compose.yml</a> définit les services des différents dockers (variables entrées/sorties, image docker utilisée)</p>
<section id="fonctionement-docker" class="level4" data-number="4.2.5.1">
<h4 data-number="4.2.5.1" class="anchored" data-anchor-id="fonctionement-docker"><span class="header-section-number">4.2.5.1</span> Fonctionement Docker</h4>
<p>Afin de pouvoir exécuter la pipeline selon différents modes, le dockerfile lance le fichier <a href="entrypoint.sh">entrypoint.sh</a>. Celui-ci prend en entrée la variable d’environnement MODE définie dans le dockercompose et permettant un lancement : - soit automatique et continue, qui fait appel au script python <a href="control_autorun.py">control_autorun.py</a> dans lequel une boucle while exécute la chaine de traitement en continue - soit en un seul coup (autres valeurs de MODE), équivalent à l’utilisation “Test” de la pipeline.</p>
<p>Tous les conteneurs sont regroupés dans le fichier <a href="docker-compose.yml">docker-compose.yml</a> où il est possible de paramétrer le script à exécuter via des variables d’environnement. Ces variables sont ensuite lues par le fichier de configuration <a href="Config_process.env">Config_process.env</a>. S’assurer donc de bien remplir le dockercompose avec les variables attendues en configuration. Toute variable non fournie dans le dockercompose sera considérée comme None dans le fichier de configuration, ce qui entrainera une erreur si les variables obligatoires ne sont pas définies.</p>
<p>La variable d’environnement WRK_DIR est par défaut reliée à la variable définie dans le fichier <a href="azure-pipelines.yml">azure-pipelines.yml</a> (cf.&nbsp;<a href="#intégration-continue-(ci)">Intégration Continue (CI)</a>). Dans le cas d’une utilisation sans CI de la pipeline, paramétrer directement le chemin du WRK_DIR dans le dockercompose (- WRK_DIR=chemin…).</p>
<p>Le fichier <a href="docker-compose.yml">docker-compose.yml</a> décrit à minima 3 dockers pour le lancement des 3 chaines principales. Néanmoins, il peut contenir autant de descriptions dockers que souhaitées, correspondant par exemple à différents cas d’usages : territoires, périodes, modes de lancements, etc. S’assurer de garder les mêmes paramètres d’entrées/sorties, en les mettant à jour selon l’usage souhaité (TERRITORY=…, MODE=…, PERIOD=…).</p>
<p>Les logs des scripts sont redirigés vers la sortie du conteneur pour les voir apparaître dans les logs via <code>docker logs &lt;container&gt; -f</code>. Pour cela, la sortie des scripts est redirigée vers le fichier <code>/proc/1/fd/1</code> qui est en fait la sortie du conteneur. L’instruction <code>2&gt;&amp;1</code> est également ajoutée pour que les erreurs soient retournées à la sortie du conteneur.</p>
</section>
</section>
<section id="exécution-docker" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="exécution-docker"><span class="header-section-number">4.2.6</span> Exécution Docker</h3>
<p>S’assurer au préalable d’avoir installé Docker sur sa machine.</p>
<p>Pour construire, créer/recréer les dockers et démarrer en mode détaché (arrière plan), exécuter :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span> <span class="at">--build</span> <span class="at">--force-recreate</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour stopper les dokers, exécuter :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> down</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="algorithmes" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="algorithmes"><span class="header-section-number">4.2.7</span> Algorithmes</h3>
<p>Les différentes chaines de la pipeline, les étapes principales de traitements, ainsi que les produits d’entrée et de sortie, sont synthétisés dans le schéma <a href="EO4DM/dmpipeline/DOC/SCHEMA_GENERAL_EO4DM.png">SCHEMA_GENERAL_EO4DM</a> : <img src="EO4DM/dmpipeline/DOC/SCHEMA_GENERAL_EO4DM.png" class="img-fluid" alt="SCHEMA_GENERAL_EO4DM"></p>
<p>Le fichier <a href="EO4DM/dmpipeline/DOC/ALGO_CHAINES_EO4DM.png">ALGO_CHAINES_EO4DM</a> présente et décrit les algorithmes des chaines ALERTES, GLOBALES et LOCALES : <img src="EO4DM/dmpipeline/DOC/ALGO_CHAINES_EO4DM.png" class="img-fluid" alt="ALGO_CHAINES_EO4DM"></p>
</section>
<section id="cas-dusages" class="level3" data-number="4.2.8">
<h3 data-number="4.2.8" class="anchored" data-anchor-id="cas-dusages"><span class="header-section-number">4.2.8</span> Cas d’usages</h3>
<p>/!&nbsp;NE TRAITE POUR LE MOMENT QUE LES CHAINES GLOBALES/LOCALES</p>
<p>S’assurer d’avoir correctement configuré l’accès à l’API GEE <a href="#configuration-google-earth-engine-(gee)">Configuration Google Earth Engine (GEE)</a>.</p>
<section id="préparation-du-dossier-annex" class="level4" data-number="4.2.8.1">
<h4 data-number="4.2.8.1" class="anchored" data-anchor-id="préparation-du-dossier-annex"><span class="header-section-number">4.2.8.1</span> Préparation du dossier ANNEX</h4>
<p>Pour la chaine GLOBALE, s’il est prévu de fournir des statistiques spatiales par zones (DROUGHT_STATS=1) : - Créer le dossier ANNEX à l’endroit correspondant au chemin ANNEX_DIR donné dans le fichier de config - Y copier le dossier <a href="EO4DM/dmpipeline/ANNEX_Data/Territory">Territory</a> et son contenu - Renommer le dossier Territory selon le nom anglais du territoire à traiter, équivalent à la variable TERRITORY du fichier de configuration (en remplaçant les espaces et enventuels caractères spéciaux par des _) - Placer dans le dossier <a href="EO4DM/dmpipeline/ANNEX_Data/Territory/Areas">Areas</a> le shapefile contenant les contours des zones sur lesquelles seront calculées les statistiques - Il est possible (facultatif) de masquer certaines surfaces à partir d’un masque d’occupation du sol ESRI contenu dans le dossier <a href="EO4DM/dmpipeline/ANNEX_Data/Territory/Landcover">Landcover</a>. Cette phase demande encore des développements et ne fonctionne que pour la Nouvelle-Calédonie (fichier <a href="EO4DM/dmpipeline/ANNEX_Data/Territory/Landcover/58K_20200101-20210101.tif">.tif</a> fourni avec le code). Dans le cas où un autre territoire que la Nouvelle-Calédonie serait traité, veiller à supprimer le fichier .tif sinon une erreur surviendra au moment du calcul des statistiques.</p>
<p>Pour la chaine LOCALE, quelque soit la configuration de lancement : - Créer le dossier ANNEX (si pas déjà fait) à l’endroit correspondant au chemin ANNEX_DIR donné dans le fichier de config - Y copier le dossier <a href="EO4DM/dmpipeline/ANNEX_Data/Landsat_Grid_Word">Landsat_Grid_Word</a> - Dans le dossier Landsat_Grid_Word, y décompresser le fichier zip</p>
<p>Le fichier de configuration <a href="Config_process.env">Config_process.env</a> est à compléter selon les préconisations ci-dessous.</p>
</section>
<section id="préconisations-de-configuration-pour-un-premier-test-de-lancement-mode-manuel" class="level4" data-number="4.2.8.2">
<h4 data-number="4.2.8.2" class="anchored" data-anchor-id="préconisations-de-configuration-pour-un-premier-test-de-lancement-mode-manuel"><span class="header-section-number">4.2.8.2</span> Préconisations de configuration pour un premier test de lancement (MODE = MANUEL)</h4>
<p>Pour un premier lancement des chaines sur un nouveau territoire, lancer celles-ci en mode manuel (MODE=MANUAL) sur une période d’un mois ou deux afin de vérifier la bonne exécution des différentes étapes de traitements ainsi que les produits fournis (indices, indicateurs). Pour la chaine LOCALE, idéalement se placer sur une période diposant à la fois de produits Landsat et S2 (2019 - ce jour)</p>
<p>Les variables d’environnement ASSET_EXPORT_* permettent de conserver sur GEE (Assets) les indices mono-date prétraités. Cela peut être utile pour : - Vérifier les indices mono-date en cas de production d’indices composites inattendus - Gagner du temps lors de la relance de la chaine sur une période déjà traitée. Si les indices mono-date sont déjà présents sur GEE et que ASSET_EXPORT_*=1, la chaine vient directement les lire, permettant un calcul plus rapide par la suite des indices composites.</p>
<p>Pour la chaine GLOBALE : - Définir la bounding box d’extraction des produits MODIS (lon_min, lat_min, lon_max, lat_max). A savoir que ce paramétrage est obligatoire lors du premier lancement, mais qu’il est ensuite facultatif pour de prochains lancements de la chaine sur la même zone (la chaine redécoupera ensuite les nouveaux indices selon l’emprise des produits historiques déjà calculés) - Si calcul des statistiques spatiales, mettre DROUGHT_STATS à 1, et paramétrer KEY_STAT avec le nom du champ contenant les noms des zones (dans fichier shapefile du dossier <a href="EO4DM//dmpipeline/ANNEX_Data/Territory/Areas">Areas</a>). KEY_STAT est facultatif, mais dans ce cas le champ doit être nommé ‘nom’.</p>
<p>Pour la chaine LOCALE, les tuiles Landsat et S2 à collecter sur GEE peuvent être pré-définies par l’utilisateur pour réduire le nombre de produits satellites haute résolution à traiter. Cela peut être utile pour des premiers tests, afin de gagner du temps. Si aucune tuile n’est donnée, la chaine collectera automatiquement les tuiles interceptant le territoire (TERRITORY) ou la zone de découpe fournie par l’utilisateur via le fichier Landmask_Grid_ROI (si LANDMASK_ROI=1).</p>
<p>A l’issue des traitements, contrôler si les dossiers de sortie de run (WRK_DIR/RUN_*) contiennent bien les produits attendus selon les préconisations décrites dans le fichier <a href="EO4DM//dmpipeline/DOC/PROCEDURE_QUALITE_INDICATEURS.xlsx">PROCEDURE_QUALITE_INDICATEURS</a>. Vérifier si les produits historiques sont également copiés vers le DATA_HISTO, à savoir : - indices composites (décades, mois) - indicateurs (décades, mois) - table(s) contenant les séries temporelles des statistiques spatiales pour chaque zone (chaine GLOBALE, si calcul demandé depuis fichier de config).</p>
<section id="préconisations-de-configuration-pour-lancement-historique-mode-auto" class="level5" data-number="4.2.8.2.1">
<h5 data-number="4.2.8.2.1" class="anchored" data-anchor-id="préconisations-de-configuration-pour-lancement-historique-mode-auto"><span class="header-section-number">4.2.8.2.1</span> Préconisations de configuration pour lancement historique (MODE = AUTO)</h5>
<p>Lancer les chaines en mode AUTO pour que celles-ci calculent automatiquement le début et la fin de la période du référentiel historique, correspondant respectivement à la date du premier produit trouvé sur GEE et la date de fin de la décade complète la plus récente (inutile de remplir PERIOD_START et PERIOD_END). Les chaines étant indépendantes, les référentiels historiques peuvent être différents d’une chaine à l’autre.</p>
<p>Mettre ASSET_EXPORT_* à 0 pour gagner du temps, ou alors s’assurer que suffisement d’espace est disponible sur GEE pour contenir l’ensemble des produits mono-dates. Pour la chaine LOCALE, les 250 Go d’espace GEE mis à disposition seront parfois insuffisants selon le territoire traité. Nous recommandons de ne pas paramétrer l’export sur GEE lors de l’exécution de la chaine LOCALE sur tout l’historique (2000 - ce jour).</p>
<p>A noter : en utilisation sous docker (“Service-Regulier”), le mode AUTO permettra également de relancer automatiquement les chaines lorsque de nouveaux produits seront disponibles sur GEE (ce qui n’est pas le cas en utilisation “Test”).</p>
</section>
<section id="calcul-des-indices-ou-indicateurs-uniquement-mode-indicesdrought" class="level5" data-number="4.2.8.2.2">
<h5 data-number="4.2.8.2.2" class="anchored" data-anchor-id="calcul-des-indices-ou-indicateurs-uniquement-mode-indicesdrought"><span class="header-section-number">4.2.8.2.2</span> Calcul des indices ou indicateurs uniquement (MODE = INDICES/DROUGHT)</h5>
<p>Il est possible de lancer qu’une partie des traitements de la chaine.</p>
<p>Le mode INDICE permet de calculer uniquement les indices composites en fixant manuellement la période de traitement. Peut s’avérer utile si besoin de recaculer les indices pour une période spécifique (produits erronés, pertes de données), puis relancer la chaine en mode AUTO par exemple.</p>
<p>Le mode DROUGHT permet de calculer uniquement les indicateurs. Cela implique de disposer au préalable d’un référentiel historique d’indices déjà calculés. Peut être utile pour mettre à jour les indicateurs sans recalcul des indices composites. L’utilisateur peut donner une période en entrée qui définira les mois de l’année à recalculer, les indicateurs étant calculés par rapport à des anomalies a minima mensuelles (VHI), voire décadaires (VHI, VAI). Par exemple, le paramétrage ‘PERIOD_START=2020-01-01’ et ‘PERIOD_END=2020-03-01’ entrainera un calcul des indicateurs pour tous les mois de Janvier et Février disponibles (PERIOD_END est exclusive). Ici seul le numéro du mois compte dans ce qui est donné en entrée de PERIOD_START et PERIOD_END. Si aucune période n’est donnée, tous les mois de l’année disponibles seront mis à jour.</p>
</section>
</section>
</section>
<section id="intégration-continue-ci" class="level3" data-number="4.2.9">
<h3 data-number="4.2.9" class="anchored" data-anchor-id="intégration-continue-ci"><span class="header-section-number">4.2.9</span> Intégration Continue (CI)</h3>
<section id="agent-azure-devops" class="level4" data-number="4.2.9.1">
<h4 data-number="4.2.9.1" class="anchored" data-anchor-id="agent-azure-devops"><span class="header-section-number">4.2.9.1</span> Agent Azure DevOps</h4>
<p>L’installation de l’agent Azure DevOps, assurant le bon déploiement de ce projet sur le serveur INSIGHT, a été décrit dans une documentation interne de l’Oeil <a href="https://dev.azure.com/Oeilnc/_git/Backup?path=/README.md&amp;_a=preview">Backup</a> afin d’assurer une centralisation de l’information des procedures d’exploitation de l’infrastructure générale de l’Observatoire.</p>
</section>
<section id="déclenchement" class="level4" data-number="4.2.9.2">
<h4 data-number="4.2.9.2" class="anchored" data-anchor-id="déclenchement"><span class="header-section-number">4.2.9.2</span> Déclenchement</h4>
<p>L’intégration continue (CI) ne se déclenche qu’à 2 conditions : - un commit vient d’être poussé sur la branche master - un tag vient d’être créé au format : v<em>.</em>.* (ex: v1.0.2) Si un commit est poussé sur une autre branche que master ou si un tag est créé qui n’est pas au format indiqué, aucun déploiement ne sera exécuté.</p>
<p>Lorsqu’un commit est poussé sur le branche master, c’est le serveur de QUALIF qui est mis à jour. Lorsqu’un tag est poussé (au bon format), c’est le serveur de PROD qui est mis à jour.</p>
<p>/!&nbsp;DOC PROJET BACKUP ??</p>
<p>Pour l’instant, seul l’agent Azure du serveur de QUALIF a été déployé, le serveur de PROD n’étant pas encore disponible. Lorsque ce dernier sera disponible, il faudra créer un nouveau pool d’agent et y déployer un nouvel agent Azure dessus. Pour ce faire, il suffit de suivre la documentation du projet Backup (partie <code>Installation d'un agent Azure sur un serveur extérieur</code>). Il faudra ensuite modifier le fichier <a href="azure-pipelines.yml">azure-pipelines.yml</a> de ce projet pour mettre à jour le nom du pool Azure dans le job qui déploie sur le serveur de PROD (cf.&nbsp;note #TODO).</p>
</section>
</section>
</section>
<section id="sec-dependencies" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-dependencies"><span class="header-section-number">4.3</span> Dépendances python des chaines version 1.0.0</h2>

</section>
<section id="etudes-réalisées" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="etudes-réalisées"><span class="header-section-number">4.4</span> Etudes réalisées</h2>
<section id="sec-gapfilling" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="sec-gapfilling"><span class="header-section-number">4.4.1</span> Etude gapfilling Landsat 7</h3>
<p>L’étude réalisée sur le gapfilling des données Landsat 7 a permis de mettre en évidence l’efficacité de la méthode de gapfilling utilisée pour combler les données manquantes. Les résultats obtenus montrent une amélioration significative de la qualité des données après gapfilling. Les images obtenues après gapfilling présentent une cohérence spatiale et temporelle satisfaisante, ce qui permet d’obtenir des indicateurs de sécheresse plus fiables et précis.</p>
<p><img src="ressources/livrables/Gap-Filling_L7/capture/synthese_B3.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/focal%20median%20b3.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/focal_mean_b3.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/1_NDWI_GapFill.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/1_NDWI_Gapfill_then_NDWI.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/1_NDWI_Gapfill_comparaisons.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/2_QMASK_Gapfill_qmask.png" class="img-fluid"> <img src="ressources/livrables/Gap-Filling_L7/capture/2_QMASK_comparaison.png" class="img-fluid"></p>
<p><object data="ressources/livrables/Note_synthese_DataCubes.pdf" type="application/pdf"><iframe src="ressources/livrables/Note_synthese_DataCubes.pdf">This browser does not support PDFs. Please download the PDF to view it: <a href="ressources/livrables/Note_synthese_DataCubes.pdf">Download PDF</a></iframe></object></p>
</section>
<section id="sec-chirps" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="sec-chirps"><span class="header-section-number">4.4.2</span> Etude CHIRPS</h3>
<p><img src="ressources/CHIRPS_BOURAIL.png" class="img-fluid" alt="Supperpostion des services CHIRPS (global 9km) et le SPI-3 mois (in situ de Météo France NC)"> <img src="ressources/CHIRPS_BOURAIL_correlation_temporel_insitu_global.png" class="img-fluid" alt="Synchronisation des informations CHIRPS et in situ"> <img src="ressources/CHIRPS_SPI3_BOURAIL_MAP_201811_9KM.png" class="img-fluid" alt="Carte de la donnée CHIRPS 9km en Novembre 2018"></p>
</section>
<section id="sec-deco-MODIS" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="sec-deco-MODIS"><span class="header-section-number">4.4.3</span> Etude décommissionnement MODIS</h3>
<section id="données-optique-indicateur-ndwi" class="level4" data-number="4.4.3.1">
<h4 data-number="4.4.3.1" class="anchored" data-anchor-id="données-optique-indicateur-ndwi"><span class="header-section-number">4.4.3.1</span> Données optique, indicateur NDWI</h4>
<div id="fig-decoMODIS" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-decoMODIS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<img src="ressources/NDWI_MODIS_201911.png" class="img-fluid figure-img" width="500">
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-decoMODIS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/comp_NDWI_VIIRS_MODIS.png" class="img-fluid figure-img"></p>
<figcaption>Comparaison d’histogrammes et modélisation linéaire pour les indices NDWI VIIRS vs NDWI MODIS, le 201911 sur la Nouvelle-Calédonie.</figcaption>
</figure>
</div>
</section>
<section id="données-de-température" class="level4" data-number="4.4.3.2">
<h4 data-number="4.4.3.2" class="anchored" data-anchor-id="données-de-température"><span class="header-section-number">4.4.3.2</span> Données de température</h4>
<div id="fig-decoMODIS2" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-decoMODIS2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<img src="ressources/LTS_MODIS_201911.png" class="img-fluid figure-img" width="500">
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-decoMODIS2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/Comp_LTS_VIIRS_MODIS.png" class="img-fluid figure-img"></p>
<figcaption>Comparaison d’histogrammes et modélisation linéaire pour les températures LST VIIRS vs LST MODIS (“chaine”), le 2019_11 sur la Nouvelle-Calédonie</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="sec-cq" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sec-cq"><span class="header-section-number">4.5</span> Aide au controle qualité des données des chaines</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/CQ_global.png" class="img-fluid figure-img"></p>
<figcaption>Contrôle qualité des données de la chaine globale</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/CQ_LOCAL.png" class="img-fluid figure-img"></p>
<figcaption>Contrôle qualité des données de la chaine locale</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ressources/CQ_ALERT.png" class="img-fluid figure-img"></p>
<figcaption>Contrôle qualité des données de la chaine alerte</figcaption>
</figure>
</div>
</section>
<section id="restitution---pgrsc" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="restitution---pgrsc"><span class="header-section-number">4.6</span> Restitution - PGRSC</h2>
<p><object data="ressources/presentation/OperationalVegetationDroughtProcessing_PGRSC_Neuhauser_et_al_2023.pdf" type="application/pdf"><iframe src="ressources/presentation/OperationalVegetationDroughtProcessing_PGRSC_Neuhauser_et_al_2023.pdf">This browser does not support PDFs. Please download the PDF to view it: <a href="ressources/presentation/OperationalVegetationDroughtProcessing_PGRSC_Neuhauser_et_al_2023.pdf">Download PDF</a></iframe></object></p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notes de bas de page</h2>

<ol>
<li id="fn1"><p>Pour plus de détails concernant le projet EO4DroughtMonitoring veuillez consulter <a href="https://www.spaceclimateobservatory.org/fr/eo4droughtmonitoring">cette url</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Pour plus d’informations sur la licence BSD, veuillez consulter l’article correspondant sur <a href="https://fr.wikipedia.org/wiki/Licence_BSD">Wikipédia</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Space Climate Observatory - <a href="https://www.spaceclimateobservatory.org/eo4dm-anticipate-drought-periods">lien vers le projet</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Réutilisation</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/SA/deed.fr">CC BY SA</a></div></div></section><section class="quarto-appendix-contents" id="quarto-copyright"><h2 class="anchored quarto-appendix-heading">Droits d'auteur</h2><div class="quarto-appendix-contents"><div>OEIL - Observatoire de l'Environnement en Nouvelle-Calédonie, tous droits réservés</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>